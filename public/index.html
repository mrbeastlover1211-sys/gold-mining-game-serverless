<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>â›ï¸ Gold Mining Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
  
  <!-- ğŸ“± MOBILE DETECTION AND BLOCKING -->
  <script>
    (function() {
      // Detect mobile, tablet, iPad
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      const isTablet = /iPad|Android|Tablet|PlayBook|Silk/i.test(navigator.userAgent) && !/Mobile/i.test(navigator.userAgent);
      const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
      
      // Check screen size as backup
      const isSmallScreen = window.innerWidth < 768;
      
      if (isMobile || isTablet || (isTouchDevice && isSmallScreen)) {
        console.log('ğŸ“± Mobile/Tablet device detected - showing desktop-only message');
        
        // Prevent page load and show message
        document.addEventListener('DOMContentLoaded', function() {
          document.body.innerHTML = `
            <div style="
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
              display: flex;
              align-items: center;
              justify-content: center;
              z-index: 999999;
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            ">
              <div style="
                text-align: center;
                padding: 40px;
                max-width: 500px;
                background: rgba(0, 0, 0, 0.8);
                border-radius: 20px;
                border: 2px solid #00d4aa;
                box-shadow: 0 10px 50px rgba(0, 212, 170, 0.3);
              ">
                <div style="font-size: 80px; margin-bottom: 20px;">ğŸ–¥ï¸</div>
                <h1 style="
                  color: #00d4aa;
                  font-size: 28px;
                  margin: 0 0 15px 0;
                  font-weight: 700;
                ">Desktop Only</h1>
                <p style="
                  color: #ffffff;
                  font-size: 18px;
                  line-height: 1.6;
                  margin: 0 0 25px 0;
                ">
                  This game is not compatible with mobile or tablet devices.
                </p>
                <p style="
                  color: #aaaaaa;
                  font-size: 16px;
                  line-height: 1.5;
                  margin: 0;
                ">
                  Please access from a desktop or laptop computer for the best experience.
                </p>
                <div style="
                  margin-top: 30px;
                  padding-top: 20px;
                  border-top: 1px solid rgba(255,255,255,0.1);
                ">
                  <p style="
                    color: #888888;
                    font-size: 14px;
                    margin: 0;
                  ">
                    â›ï¸ Gold Mining Game<br>
                    <span style="color: #666;">Optimized for Desktop</span>
                  </p>
                </div>
              </div>
            </div>
          `;
        });
      }
    })();
  </script>
  <!-- <script src="hotfix.js"></script> DISABLED - Using clean main-fixed.js instead -->
  <script src="https://cdn.jsdelivr.net/npm/buffer@6.0.3/index.js"></script>
  <script>
    // Setup comprehensive Buffer polyfill for Solana Web3.js
    if (typeof global === 'undefined') {
      window.global = window;
    }
    
    // Ensure Buffer and all its methods are available
    if (typeof Buffer === 'undefined' || typeof Buffer.from === 'undefined') {
      const BufferPolyfill = buffer.Buffer;
      window.Buffer = BufferPolyfill;
      global.Buffer = BufferPolyfill;
      
      // Ensure all Buffer static methods are available
      if (!Buffer.from) Buffer.from = BufferPolyfill.from;
      if (!Buffer.alloc) Buffer.alloc = BufferPolyfill.alloc;
      if (!Buffer.allocUnsafe) Buffer.allocUnsafe = BufferPolyfill.allocUnsafe;
      if (!Buffer.isBuffer) Buffer.isBuffer = BufferPolyfill.isBuffer;
      if (!Buffer.concat) Buffer.concat = BufferPolyfill.concat;
    }
    
    console.log('ğŸ”§ Buffer polyfill setup:', typeof Buffer);
    console.log('ğŸ”§ Buffer.from available:', typeof Buffer.from);
    console.log('ğŸ”§ Buffer.alloc available:', typeof Buffer.alloc);
  </script>
  
  <!-- ğŸš© EMBEDDED SMART CACHE SYSTEM - PERMANENT INFINITE LOOP PREVENTION -->
  <script>
    console.log('ğŸš© EMBEDDED SMART CACHE: Loading infinite loop prevention system...');
    
    // ğŸš© SMART LAND STATUS CACHE - 3-LAYER SYSTEM EMBEDDED IN HTML
    window.EMBEDDED_LAND_CACHE = {
      // Layer 1: Memory cache (fastest - 5 minutes)
      memoryCache: new Map(),
      
      // Layer 2: localStorage (persistent - 10 minutes)
      CACHE_KEY_PREFIX: 'gm_land_embedded_',
      MEMORY_EXPIRY: 5 * 60 * 1000,    // 5 minutes
      STORAGE_EXPIRY: 10 * 60 * 1000,   // 10 minutes
      
      // Layer 3: API call control
      apiCallInProgress: false,
      
      // Generate cache key for localStorage
      getCacheKey(address) {
        return this.CACHE_KEY_PREFIX + address;
      },
      
      // MAIN FUNCTION: Check land status with cascading fallbacks
      async checkLandStatus(address) {
        if (!address) {
          console.log('ğŸš© EMBEDDED: No address provided');
          return null;
        }
        
        const shortAddr = address.slice(0, 8) + '...';
        const now = Date.now();
        
        // ğŸ¯ LAYER 1: Check memory cache first (fastest)
        if (this.memoryCache.has(address)) {
          const memoryData = this.memoryCache.get(address);
          
          if (now - memoryData.timestamp < this.MEMORY_EXPIRY) {
            console.log(`ğŸš© EMBEDDED LAYER 1: ${shortAddr} land status = ${memoryData.hasLand} (cached)`);
            return memoryData.hasLand;
          } else {
            console.log(`ğŸš© EMBEDDED LAYER 1: Cache expired for ${shortAddr}`);
            this.memoryCache.delete(address);
          }
        }
        
        // ğŸ¯ LAYER 2: Check localStorage cache (persistent)
        try {
          const cacheKey = this.getCacheKey(address);
          const storedData = localStorage.getItem(cacheKey);
          
          if (storedData) {
            const parsed = JSON.parse(storedData);
            
            if (now - parsed.timestamp < this.STORAGE_EXPIRY) {
              console.log(`ğŸš© EMBEDDED LAYER 2: ${shortAddr} land status = ${parsed.hasLand} (cached)`);
              
              // Restore to memory cache
              this.memoryCache.set(address, parsed);
              return parsed.hasLand;
            } else {
              console.log(`ğŸš© EMBEDDED LAYER 2: Cache expired for ${shortAddr}`);
              localStorage.removeItem(cacheKey);
            }
          }
        } catch (error) {
          console.log(`ğŸš© EMBEDDED LAYER 2: Error reading cache for ${shortAddr}:`, error);
        }
        
        // ğŸ¯ LAYER 3: API call (only if both caches failed)
        if (this.apiCallInProgress) {
          console.log(`ğŸš© EMBEDDED LAYER 3: API call already in progress for ${shortAddr}`);
          return null;
        }
        
        console.log(`ğŸš© EMBEDDED LAYER 3: Making fresh API call for ${shortAddr}...`);
        this.apiCallInProgress = true;
        
        try {
          const response = await fetch(`/api/land-status?address=${encodeURIComponent(address)}`);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
          const result = await response.json();
          console.log(`ğŸš© EMBEDDED LAYER 3: Fresh data for ${shortAddr}:`, result);
          
          // Update all cache layers with fresh data
          this.updateAllLayers(address, result.hasLand);
          
          return result.hasLand;
          
        } catch (error) {
          console.error(`ğŸš© EMBEDDED LAYER 3: API failed for ${shortAddr}:`, error);
          return null;
        } finally {
          this.apiCallInProgress = false;
        }
      },
      
      // Update all cache layers with fresh data
      updateAllLayers(address, hasLand) {
        const timestamp = Date.now();
        const data = { hasLand, timestamp };
        
        // Update memory cache
        this.memoryCache.set(address, data);
        console.log(`ğŸš© EMBEDDED MEMORY: ${address.slice(0, 8)}... = ${hasLand}`);
        
        // Update localStorage cache
        try {
          const cacheKey = this.getCacheKey(address);
          localStorage.setItem(cacheKey, JSON.stringify(data));
          console.log(`ğŸš© EMBEDDED STORAGE: ${address.slice(0, 8)}... = ${hasLand}`);
        } catch (error) {
          console.log(`ğŸš© EMBEDDED STORAGE: Update failed - ${error.message}`);
        }
      },
      
      // Force update when land is purchased
      setLandStatus(address, hasLand) {
        console.log(`ğŸš© EMBEDDED FORCE: ${address.slice(0, 8)}... = ${hasLand} (manual)`);
        this.updateAllLayers(address, hasLand);
      }
    };
    
    // ğŸ›¡ï¸ EMBEDDED FUNCTION OVERRIDE SYSTEM
    window.EMBEDDED_OVERRIDE = {
      isActive: false,
      
      // Override problematic functions once they load
      activateOverrides() {
        if (this.isActive) return;
        this.isActive = true;
        
        console.log('ğŸ›¡ï¸ EMBEDDED: Activating function overrides...');
        
        // Override checkLandStatusAndShowPopup with smart cache
        if (typeof window.checkLandStatusAndShowPopup === 'function') {
          console.log('ğŸ”§ EMBEDDED: Overriding checkLandStatusAndShowPopup');
          
          window.checkLandStatusAndShowPopup = async function() {
            if (!state?.address) {
              console.log('ğŸš© EMBEDDED: No wallet connected');
              return;
            }
            
            console.log('ğŸš© EMBEDDED: Smart land check starting...');
            
            const hasLand = await window.EMBEDDED_LAND_CACHE.checkLandStatus(state.address);
            
            if (hasLand === null) {
              console.log('ğŸš© EMBEDDED: Cannot determine status, safe fallback');
              if (typeof showMandatoryLandModal === 'function') showMandatoryLandModal();
              return;
            }
            
            if (hasLand) {
              console.log('âœ… EMBEDDED: User has land - hiding modal');
              if (typeof hideMandatoryLandModal === 'function') hideMandatoryLandModal();
            } else {
              console.log('ğŸš¨ EMBEDDED: User needs land - showing modal');
              if (typeof showMandatoryLandModal === 'function') showMandatoryLandModal();
            }
            
            console.log('ğŸš© EMBEDDED: Land check complete - NO promoter triggers');
          };
        }
        
        // Override updatePromotersStatus with smart cache
        if (typeof window.updatePromotersStatus === 'function') {
          console.log('ğŸ”§ EMBEDDED: Overriding updatePromotersStatus');
          
          window.updatePromotersStatus = async function() {
            const currentAddress = (window.state && window.state.address) || window.solana?.publicKey?.toString() || window.phantom?.solana?.publicKey?.toString() || null;
            const walletConnected = !!(currentAddress && currentAddress.length > 20);
            
            console.log('ğŸ“ˆ EMBEDDED: Smart promoter update...', { walletConnected, current: currentAddress?.slice(0,8)+'...' });
            
            // Update wallet status indicator regardless of land
            const walletStatusEl = document.getElementById('walletStatusPromoters');
            if (walletStatusEl) {
              walletStatusEl.textContent = walletConnected ? 'âœ… Connected' : 'âŒ Not Connected';
              walletStatusEl.style.color = walletConnected ? '#4CAF50' : '#f44336';
            }
            
            // If not connected, show requirements and exit
            if (!walletConnected) {
              const req = document.getElementById('promotersRequirement');
              const link = document.getElementById('promotersLinkSection');
              if (req) req.style.display = 'block';
              if (link) link.style.display = 'none';
              console.log('âš ï¸ EMBEDDED: Wallet not connected - promoter UI set to requirements');
              return;
            }
            
            // Connected: check land via embedded cache using currentAddress
            const hasLand = await window.EMBEDDED_LAND_CACHE.checkLandStatus(currentAddress);
            
            // Update land status UI
            const landStatusEl = document.getElementById('landStatusPromoters');
            if (landStatusEl) {
              landStatusEl.textContent = hasLand ? 'âœ… Owned' : 'âŒ No Land';
              landStatusEl.style.color = hasLand ? '#4CAF50' : '#f44336';
            }
            
            // Toggle sections
            const req = document.getElementById('promotersRequirement');
            const link = document.getElementById('promotersLinkSection');
            if (hasLand) {
              if (req) req.style.display = 'none';
              if (link) link.style.display = 'block';
              // Fill link with dynamic or fallback
              try {
                const res = await fetch('/api/generate-dynamic-referral', { method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify({ referrerAddress: currentAddress }) });
                const data = await res.json();
                const input = document.getElementById('promotersLink');
                if (input) input.value = data?.success && data?.referralLink ? data.referralLink : `${window.location.origin}/?ref=${currentAddress}`;
              } catch (e) {
                const input = document.getElementById('promotersLink');
                if (input) input.value = `${window.location.origin}/?ref=${currentAddress}`;
              }
            } else {
              if (req) req.style.display = 'block';
              if (link) link.style.display = 'none';
            }
            
            console.log('ğŸ“ˆ EMBEDDED: Promoter update complete - NO extra API land checks');
          };
        }
        
        // Override updateReferralStatus with smart cache
        if (typeof window.updateReferralStatus === 'function') {
          console.log('ğŸ”§ EMBEDDED: Overriding updateReferralStatus');
          
          window.updateReferralStatus = async function() {
            const currentAddress = (window.state && window.state.address) || window.solana?.publicKey?.toString() || window.phantom?.solana?.publicKey?.toString() || null;
            const walletConnected = !!(currentAddress && currentAddress.length > 20);
            
            console.log('ğŸ EMBEDDED: Smart referral update...', { walletConnected, current: currentAddress?.slice(0,8)+'...' });
            
            // Update wallet status indicator regardless of land
            const walletStatusEl = document.getElementById('walletStatusReferral');
            if (walletStatusEl) {
              walletStatusEl.textContent = walletConnected ? 'âœ… Connected' : 'âŒ Not Connected';
              walletStatusEl.style.color = walletConnected ? '#4CAF50' : '#f44336';
            }
            
            // If not connected, show requirements and exit
            if (!walletConnected) {
              const req = document.getElementById('referralRequirement');
              const link = document.getElementById('referralLinkSection');
              if (req) req.style.display = 'block';
              if (link) link.style.display = 'none';
              console.log('âš ï¸ EMBEDDED: Wallet not connected - referral UI set to requirements');
              return;
            }
            
            // Connected: check land via embedded cache using currentAddress
            const hasLand = await window.EMBEDDED_LAND_CACHE.checkLandStatus(currentAddress);
            
            // Update land status UI
            const landStatusEl = document.getElementById('landStatusReferral');
            if (landStatusEl) {
              landStatusEl.textContent = hasLand ? 'âœ… Owned' : 'âŒ No Land';
              landStatusEl.style.color = hasLand ? '#4CAF50' : '#f44336';
            }
            
            // Toggle sections
            const req = document.getElementById('referralRequirement');
            const link = document.getElementById('referralLinkSection');
            if (hasLand) {
              if (req) req.style.display = 'none';
              if (link) link.style.display = 'block';
              // Fill link with dynamic or fallback
              try {
                const res = await fetch('/api/generate-dynamic-referral', { method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify({ referrerAddress: currentAddress }) });
                const data = await res.json();
                const input = document.getElementById('referralLink');
                if (input) input.value = data?.success && data?.referralLink ? data.referralLink : `${window.location.origin}/?ref=${currentAddress}`;
              } catch (e) {
                const input = document.getElementById('referralLink');
                if (input) input.value = `${window.location.origin}/?ref=${currentAddress}`;
              }
              
              // Update referral stats (with 60-second cache)
              const cacheKey = `referral_stats_${currentAddress}`;
              const cachedData = sessionStorage.getItem(cacheKey);
              const cacheTime = sessionStorage.getItem(`${cacheKey}_time`);
              const now = Date.now();
              
              // Use cache if less than 60 seconds old
              if (cachedData && cacheTime && (now - parseInt(cacheTime)) < 60000) {
                const statsData = JSON.parse(cachedData);
                const totalEl = document.getElementById('totalReferrals');
                if (totalEl) totalEl.textContent = statsData.referrer_stats.total_referrals || 0;
                console.log('ğŸ“Š Referral stats from cache:', statsData.referrer_stats);
              } else {
                // Fetch fresh data
                try {
                  const statsRes = await fetch(`/api/referral-status?address=${currentAddress}`);
                  const statsData = await statsRes.json();
                  if (statsData.success && statsData.referrer_stats) {
                    // Update UI
                    const totalEl = document.getElementById('totalReferrals');
                    if (totalEl) totalEl.textContent = statsData.referrer_stats.total_referrals || 0;
                    
                    // Cache for 60 seconds
                    sessionStorage.setItem(cacheKey, JSON.stringify(statsData));
                    sessionStorage.setItem(`${cacheKey}_time`, now.toString());
                    
                    console.log('ğŸ“Š Referral stats updated:', {
                      total: statsData.referrer_stats.total_referrals,
                      completed: statsData.referrer_stats.completed_referrals,
                      pending: statsData.referrer_stats.pending_referrals
                    });
                  }
                } catch (e) {
                  console.log('âš ï¸ EMBEDDED: Could not fetch referral stats:', e);
                }
              }
            } else {
              if (req) req.style.display = 'block';
              if (link) link.style.display = 'none';
            }
            
            console.log('ğŸ EMBEDDED: Referral update complete - NO extra API land checks');
          };
        }
        
        console.log('âœ… EMBEDDED: All function overrides active');
      }
    };
    
    // Activate overrides after main.js loads
    setTimeout(() => {
      window.EMBEDDED_OVERRIDE.activateOverrides();
    }, 1000);
    
    // Also try activation every 2 seconds for the first 10 seconds
    let activationAttempts = 0;
    const activationInterval = setInterval(() => {
      activationAttempts++;
      window.EMBEDDED_OVERRIDE.activateOverrides();
      
      if (activationAttempts >= 5) {
        clearInterval(activationInterval);
      }
    }, 2000);
    
    console.log('âœ… EMBEDDED SMART CACHE: Infinite loop prevention system loaded');
  </script>
  <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
</head>
<body>
  <div class="game-dashboard">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon">
            <img src="assets/pickaxes/pickaxe-netherite-left.gif" alt="Mining" class="logo-pickaxe-gif">
          </div>
          <h1>GOLD MINING</h1>
        </div>
        <nav class="header-nav">
          <button class="nav-link how-it-works-btn" onclick="showHowItWorksModal()">â“ How to Play</button>
          <button class="nav-link leaderboard-btn" onclick="window.location.href='leaderboard.html'">ğŸ† Leaderboard</button>
        </nav>
      </div>
      <div class="header-buttons">
        <button id="promotersBtn" class="promoters-btn" onclick="showPromotersModal()">ğŸ“ˆ Promoters</button>
        <button id="battlezoneBtn" class="battlezone-btn" onclick="showBattlezoneModal()">âš”ï¸ V2.0 Battlezone</button>
        <button id="v2ComingSoonBtn" class="v2-coming-soon-btn">ğŸ„ Christmas Edition</button>
        <button id="referBtn" class="refer-btn">ğŸ Refer & Earn</button>
        <button id="connectBtn" class="connect-btn">ğŸ”— Connect Wallet</button>
      </div>
    </header>

    <!-- Stats Panel -->
    <div class="stats-panel">
      <div class="panel-title">ğŸ“Š Your Stats</div>
      
      <div class="stat-item">
        <div class="stat-label">ğŸ’° Total Gold</div>
        <div id="totalGold" class="stat-value highlight">0</div>
      </div>
      
      <div class="stat-item">
        <div class="stat-label">â›ï¸ Total Pickaxes</div>
        <div id="totalPickaxes" class="stat-value">0</div>
      </div>
      
      <div class="stat-item">
        <div class="stat-label">âš¡ Mining Rate</div>
        <div id="miningRate" class="stat-value highlight">0/sec</div>
      </div>
      
      <div class="stat-item">
        <div class="stat-label">ğŸ’ Gold Price</div>
        <div id="goldPrice" class="stat-value">0 SOL</div>
      </div>
      
      <div class="stat-item">
        <div class="stat-label">ğŸ“ˆ Min Trade</div>
        <div id="minSell" class="stat-value">0</div>
      </div>
    </div>

    <!-- Store Panel (Now Clickable Button) -->
    <div class="wallet-panel gold-store-button" onclick="openGoldStoreModal()">
      <div class="panel-title">ğŸª Gold Store</div>
      <div class="store-button-content">
        <div class="store-button-text">ğŸ’° Buy More Pickaxes Using Gold</div>
        <div class="store-button-subtitle">Click to view available pickaxes</div>
      </div>
    </div>
    
    <!-- Gold Store Modal (Hidden by default) -->
    <div id="goldStoreModal" class="gold-store-modal" onclick="closeGoldStoreModal(event)">
      <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
          <div class="modal-title">ğŸª Gold Store - Buy Pickaxes with Gold</div>
          <button class="modal-close-btn" onclick="closeGoldStoreModal()">âœ–</button>
        </div>
        
        <div class="modal-body">
          <div class="store-items-modal">
            <!-- Silver Pickaxe -->
            <div class="store-item-modal">
              <div class="store-item-header">
                <div class="store-pickaxe-icon silver">
                  <img src="assets/pickaxes/pickaxe-silver.png" alt="Silver Pickaxe" style="width: 30px; height: 30px; object-fit: contain;">
                </div>
                <div class="store-item-info">
                  <div class="store-item-name">Silver Pickaxe</div>
                  <div class="store-item-rate">+1 gold/min</div>
                </div>
              </div>
              <div class="store-price">5,000 Gold</div>
              
              <!-- Detailed information -->
              <div class="store-item-details-modal">
                <div class="detail-row">
                  <span class="detail-label">âš¡ Mining Power:</span>
                  <span class="detail-value">+1 gold per minute</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">ğŸ“Š You Own:</span>
                  <span class="detail-value" id="modal-silver-owned-count">0 pickaxes</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">ğŸ’¡ Tip:</span>
                  <span class="detail-value">Perfect for steady income growth!</span>
                </div>
              </div>
              
              <button class="store-buy-btn-modal" onclick="buyPickaxeWithGold('silver', 5000)">
                ğŸ›’ Buy Silver Pickaxe
              </button>
            </div>
            
            <!-- Gold Pickaxe -->
            <div class="store-item-modal">
              <div class="store-item-header">
                <div class="store-pickaxe-icon gold">
                  <img src="assets/pickaxes/pickaxe-gold.png" alt="Gold Pickaxe" style="width: 30px; height: 30px; object-fit: contain;">
                </div>
                <div class="store-item-info">
                  <div class="store-item-name">Gold Pickaxe</div>
                  <div class="store-item-rate">+10 gold/min</div>
                </div>
              </div>
              <div class="store-price">20,000 Gold</div>
              
              <!-- Detailed information -->
              <div class="store-item-details-modal">
                <div class="detail-row">
                  <span class="detail-label">âš¡ Mining Power:</span>
                  <span class="detail-value">+10 gold per minute</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">ğŸ“Š You Own:</span>
                  <span class="detail-value" id="modal-gold-owned-count">0 pickaxes</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">ğŸ’¡ Tip:</span>
                  <span class="detail-value">10x more powerful than Silver!</span>
                </div>
              </div>
              
              <button class="store-buy-btn-modal" onclick="buyPickaxeWithGold('gold', 20000)">
                ğŸ›’ Buy Gold Pickaxe
              </button>
            </div>
          </div>
        </div>
        
        <!-- Store Status Message -->
        <div id="modalStoreMsg" class="store-message-modal"></div>
      </div>
    </div>

    <!-- Shop Panel -->
    <div class="shop-panel">
      <div class="panel-title">ğŸ›’ Pickaxe Shop</div>
      <div class="pickaxe-grid" id="pickaxeGrid">
        <!-- Pickaxes will be populated by JavaScript -->
      </div>
      <div id="shopMsg" class="msg"></div>
    </div>

    <!-- Mining Panel -->
    <div class="mining-panel">
      <div class="panel-title">
        <img src="assets/pickaxes/pickaxe-netherite.gif" alt="Mining" class="title-pickaxe-gif"> Mining Operation
      </div>
      <div class="mining-display">
        <div class="mining-icon">
          <img src="assets/pickaxes/pickaxe-netherite.gif" alt="Mining" class="mining-title-gif">
        </div>
        <div id="currentMiningRate" class="mining-rate">+0 gold/sec</div>
        <div id="miningStatus" class="mining-status">Ready to start mining!</div>
      </div>
      
      <div class="simple-inventory">
        <div class="inventory-title">Your Pickaxes:</div>
        <div id="pickaxeInventoryGrid" class="pickaxe-inventory-grid">
          <div class="inventory-item" data-type="silver">
            <div class="inventory-icon silver">
              <img src="assets/pickaxes/pickaxe-silver.png" alt="Silver" class="pickaxe-mini-icon">
            </div>
            <div class="inventory-count" id="silver-count">0</div>
          </div>
          <div class="inventory-item" data-type="gold">
            <div class="inventory-icon gold">
              <img src="assets/pickaxes/pickaxe-gold.png" alt="Gold" class="pickaxe-mini-icon">
            </div>
            <div class="inventory-count" id="gold-count">0</div>
          </div>
          <div class="inventory-item" data-type="diamond">
            <div class="inventory-icon diamond">
              <img src="assets/pickaxes/pickaxe-diamond.png" alt="Diamond" class="pickaxe-mini-icon">
            </div>
            <div class="inventory-count" id="diamond-count">0</div>
          </div>
          <div class="inventory-item" data-type="netherite">
            <div class="inventory-icon netherite">
              <img src="assets/pickaxes/pickaxe-netherite.gif" alt="Netherite" class="pickaxe-mini-icon">
            </div>
            <div class="inventory-count" id="netherite-count">0</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Selling Panel -->
    <div class="selling-panel">
      <div class="panel-title">ğŸ’° Sell Gold</div>
      <input type="number" id="goldToSell" class="sell-input" placeholder="Enter gold amount to sell" />
      <button id="sellBtn" class="sell-btn">ğŸ’° Sell Gold for SOL</button>
      <div id="sellMsg" class="msg"></div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-left">
        <div class="footer-info">
          ğŸ® Powered by Solana Blockchain<br>
          âš¡ Real-time mining â€¢ ğŸ”’ Secure transactions
        </div>
      </div>
      <div class="footer-right">
        <div class="network-status">
          <div class="status-dot"></div>
          <span>Solana Devnet</span>
        </div>
        <div class="footer-stats">
          <div>Version 1.0.0</div>
          <div id="footerStats">Total Players: Loading...</div>
        </div>
      </div>
    </footer>
  </div>

  <!-- Land Purchase Modal -->
  <div id="landModal" class="modal-overlay mandatory-modal">
    <div class="modal-content land-modal">
      <div class="modal-header land-header">
        <h2>ğŸï¸ Welcome to Gold Mining!</h2>
        <!-- No close button - mandatory modal -->
      </div>
      
      <div class="modal-body">
        <div class="land-hero">
          <div class="land-icon">ğŸï¸</div>
          <h3>Purchase Your Mining Land</h3>
          <p>Before you can start mining gold and earning SOL, you need to purchase a mining plot!</p>
        </div>

        <div class="land-features">
          <div class="feature-item">
            <div class="feature-icon">â›ï¸</div>
            <div class="feature-text">
              <strong>Unlimited Mining Rights</strong>
              <p>Mine gold 24/7 with any pickaxe you own</p>
            </div>
          </div>
          
          <div class="feature-item">
            <div class="feature-icon">ğŸ›’</div>
            <div class="feature-text">
              <strong>Access to Shop</strong>
              <p>Buy powerful pickaxes to start your mining operation</p>
            </div>
          </div>
          
          <div class="feature-item">
            <div class="feature-icon">ğŸ”„</div>
            <div class="feature-text">
              <strong>One-Time Payment</strong>
              <p>Pay once, mine forever - no recurring fees!</p>
            </div>
          </div>
          
          <div class="feature-item">
            <div class="feature-icon">ğŸš€</div>
            <div class="feature-text">
              <strong>Instant Access</strong>
              <p>Start mining immediately after purchase</p>
            </div>
          </div>
        </div>

        <div class="land-price-section">
          <div class="price-box">
            <div class="price-label">Mining Land Price</div>
            <div class="price-amount">0.01 SOL</div>
          </div>
        </div>

        <div class="land-benefits">
          <h4>ğŸ¯ What You Get:</h4>
          <ul>
            <li>âœ… Permanent mining rights</li>
            <li>âœ… Access to pickaxe shop</li>
            <li>âœ… Access to all game features</li>
            <li>âœ… Referral system eligibility</li>
            <li>âœ… Future updates & features</li>
          </ul>
        </div>

        <button id="purchaseLandBtn" class="land-purchase-btn" onclick="purchaseLand()">
          ğŸï¸ Purchase Mining Land (0.01 SOL)
        </button>
        
        <div id="landMsg" class="msg"></div>
        
        <div class="land-disclaimer">
          <p>ğŸ”’ Secure payment via Solana blockchain â€¢ One-time setup fee â€¢ No hidden charges</p>
        </div>
      </div>
    </div>
  </div>

  <!-- How it Works Modal -->
  <div id="howItWorksModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>â“ How it Works?</h2>
        <button class="modal-close" onclick="hideHowItWorksModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="how-it-works-hero">
          <div class="how-it-works-icon">âš¡</div>
          <p>Simple 3-step process to start earning SOL!</p>
        </div>
        
        <div class="steps-container">
          <div class="step-item">
            <div class="step-number">1</div>
            <div class="step-content">
              <div class="step-icon">ğŸ›’</div>
              <h3>Buy Land and Pickaxe to Start Gold Mining</h3>
              <p>Purchase your first pickaxe to begin mining gold. Different pickaxes mine at different rates - start with Silver and upgrade as you earn!</p>
            </div>
          </div>
          
          <div class="step-item">
            <div class="step-number">2</div>
            <div class="step-content">
              <div class="step-icon">â›ï¸</div>
              <h3>Mine Gold and Buy More Pickaxes</h3>
              <p>Watch your gold accumulate automatically! Use your earnings to buy more powerful pickaxes for faster mining rates.</p>
            </div>
          </div>
          
          <div class="step-item">
            <div class="step-number">3</div>
            <div class="step-content">
              <div class="step-icon">ğŸ’°</div>
              <h3>Sell Gold and Get SOL Anytime</h3>
              <p>Convert your mined gold to SOL whenever you want! Instant withdrawals available 24/7 to your connected wallet.</p>
            </div>
          </div>
        </div>
        
        <div class="how-it-works-cta">
          <button class="start-mining-btn" onclick="hideHowItWorksModal()">ğŸš€ Start Mining Now!</button>
        </div>
      </div>
    </div>
  </div>

  <!-- V2.0 Battlezone Edition Modal -->
  <div id="battlezoneModal" class="modal-overlay">
    <div class="modal-content battlezone-modal">
      <div class="modal-header battlezone-header">
        <h2>âš”ï¸ V2.0 BATTLEZONE EDITION ğŸ’€</h2>
        <button class="modal-close" onclick="closeBattlezoneModal()">Ã—</button>
      </div>
      
      <div class="modal-body battlezone-body">
        <div class="battlezone-hero">
          <div class="battlezone-icon">âš”ï¸ğŸ’€âš”ï¸</div>
          <h3>ULTIMATE 1v1 BATTLEFIELD COMBAT</h3>
          <p class="battlezone-tagline">Kill or Be Killed - Winner Takes All!</p>
        </div>
        
        <!-- Countdown Timer -->
        <div class="countdown-section">
          <h3>ğŸš€ LAUNCHING IN:</h3>
          <div class="countdown-timer" id="battlezoneCountdown">
            <div class="time-block">
              <span class="time-number" id="days">000</span>
              <span class="time-label">DAYS</span>
            </div>
            <div class="time-block">
              <span class="time-number" id="hours">00</span>
              <span class="time-label">HOURS</span>
            </div>
            <div class="time-block">
              <span class="time-number" id="minutes">00</span>
              <span class="time-label">MINUTES</span>
            </div>
            <div class="time-block">
              <span class="time-number" id="seconds">00</span>
              <span class="time-label">SECONDS</span>
            </div>
          </div>
          <div class="launch-date">December 10, 2025</div>
        </div>
        
        <!-- Game Features -->
        <div class="battlezone-features">
          <div class="feature-row danger">
            <div class="feature-icon">ğŸ’€</div>
            <div class="feature-content">
              <h4>HIGH RISK - HIGH REWARD</h4>
              <p>Lose everything or win everything. No middle ground!</p>
            </div>
          </div>
          
          <div class="feature-row combat">
            <div class="feature-icon">âš”ï¸</div>
            <div class="feature-content">
              <h4>1v1 BATTLEFIELD COMBAT</h4>
              <p>Face your opponent in intense one-on-one battles</p>
            </div>
          </div>
          
          <div class="feature-row stakes">
            <div class="feature-icon">ğŸ’°</div>
            <div class="feature-content">
              <h4>ALL-OR-NOTHING STAKES</h4>
              <p>Winner takes ALL gold and pickaxes from the loser</p>
            </div>
          </div>
          
          <div class="feature-row victory">
            <div class="feature-icon">ğŸ‘‘</div>
            <div class="feature-content">
              <h4>ULTIMATE VICTORY</h4>
              <p>Dominate the battlefield and claim your rewards</p>
            </div>
          </div>
        </div>
        
        <!-- Warning Section -->
        <div class="battlezone-warning">
          <div class="warning-icon">âš ï¸</div>
          <div class="warning-content">
            <h4>DANGER ZONE WARNING</h4>
            <p><strong>This is NOT for the weak!</strong></p>
            <p>â€¢ Lose ALL your gold and pickaxes if defeated</p>
            <p>â€¢ Only the strongest miners survive</p>
            <p>â€¢ Enter at your own risk - no refunds</p>
          </div>
        </div>
        
        <!-- Battle Stats Preview -->
        <div class="battle-stats">
          <h3>âš¡ BATTLE STATISTICS</h3>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number">0</div>
              <div class="stat-label">Battles Fought</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">0</div>
              <div class="stat-label">Victories</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">0</div>
              <div class="stat-label">SOL Won</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">0</div>
              <div class="stat-label">Rank</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer battlezone-footer">
        <button class="battlezone-cta-btn" onclick="joinWaitlistBattlezone()">
          ğŸ”¥ JOIN BATTLEZONE WAITLIST ğŸ”¥
        </button>
        <p class="footer-warning">Prepare for war. Only the strongest will survive.</p>
      </div>
    </div>
  </div>

  <!-- Promoters Modal -->
  <div id="promotersModal" class="modal-overlay">
    <div class="modal-content promoters-modal">
      <div class="modal-header promoters-header">
        <h2>ğŸ“ˆ Become a Promoter & Earn SOL Daily! ğŸ’°</h2>
        <button class="modal-close" onclick="closePromotersModal()">Ã—</button>
      </div>
      
      <div class="modal-body">
        <div class="promoters-hero">
          <div class="promoters-icon">ğŸ’°ğŸ“ˆ</div>
          <h3>Earn 5-50 SOL Daily by Promoting Our Game!</h3>
          <p>Share our banners on social media and get paid every 24 hours! ğŸš€</p>
        </div>
        
        <div class="promoters-features">
          <div class="feature-grid">
            <div class="feature-item">
              <div class="feature-icon">ğŸ’°</div>
              <h4>Daily Payouts</h4>
              <p>Earn 5-50 SOL per day based on traffic you generate</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">ğŸ“Š</div>
              <h4>Performance Based</h4>
              <p>More traffic = Higher rewards. Top promoters earn the most!</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">â°</div>
              <h4>24 Hour Payouts</h4>
              <p>Get paid every 24 hours after your posts are verified</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">ğŸ¯</div>
              <h4>Easy Process</h4>
              <p>Post banner â†’ Create ticket â†’ Get paid!</p>
            </div>
          </div>
        </div>
        
        <div class="promoters-process">
          <h3>ğŸ¯ How It Works</h3>
          <div class="process-steps">
            <div class="step">
              <div class="step-number">1</div>
              <div class="step-content">
                <h4>ğŸ“± Post on Social Media</h4>
                <p>Share our banners on X, Instagram, TikTok, Facebook, LinkedIn</p>
              </div>
            </div>
            <div class="step">
              <div class="step-number">2</div>
              <div class="step-content">
                <h4>ğŸ« Create Support Ticket</h4>
                <p>Message us on Telegram and email promoters@thegoldmining.com</p>
              </div>
            </div>
            <div class="step">
              <div class="step-number">3</div>
              <div class="step-content">
                <h4>â° Keep Post Active</h4>
                <p>Post must stay live for 24 hours for verification</p>
              </div>
            </div>
            <div class="step">
              <div class="step-number">4</div>
              <div class="step-content">
                <h4>ğŸ’° Get Paid</h4>
                <p>Receive 5-50 SOL based on traffic generated</p>
              </div>
            </div>
          </div>
        </div>
        
        <div id="promotersLinkSection" class="promoters-link-section" style="display: none;">
          <div class="promoters-link-container">
            <h3>ğŸ”— Your Promoter Link</h3>
            <div class="link-copy-container">
              <input type="text" id="promotersLink" readonly placeholder="Your promoter link will appear here..." />
              <button id="copyPromotersLinkBtn" class="copy-btn">ğŸ“‹ Copy</button>
            </div>
            <p class="link-info">âœ… Share this link in your social media posts to track your referrals!</p>
          </div>
          
          <div class="banner-download-section">
            <h3>ğŸ¨ Download Promotional Banners</h3>
            <p>Download these professional banners to post on your social media:</p>
            <div class="banner-grid">
              <div class="banner-item">
                <div class="banner-preview">
                  <img src="assets/banners/banner-square.png" alt="Square Banner" class="banner-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                  <div class="banner-placeholder" style="display: none;">ğŸ® SQUARE BANNER<br>1080x1080</div>
                </div>
                <div class="banner-info">
                  <div class="banner-name">Square Banner</div>
                  <div class="banner-size">1080x1080 â€¢ Instagram/Facebook</div>
                  <button class="banner-download-btn" onclick="downloadBanner('square')">â¬‡ï¸ Download</button>
                </div>
              </div>
              
              <div class="banner-item">
                <div class="banner-preview">
                  <img src="assets/banners/banner-wide.png" alt="Wide Banner" class="banner-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                  <div class="banner-placeholder" style="display: none;">ğŸ® WIDE BANNER<br>1200x628</div>
                </div>
                <div class="banner-info">
                  <div class="banner-name">Wide Banner</div>
                  <div class="banner-size">1200x628 â€¢ Twitter/LinkedIn</div>
                  <button class="banner-download-btn" onclick="downloadBanner('wide')">â¬‡ï¸ Download</button>
                </div>
              </div>
              
              <div class="banner-item">
                <div class="banner-preview">
                  <img src="assets/banners/banner-vertical.png" alt="Vertical Banner" class="banner-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                  <div class="banner-placeholder" style="display: none;">ğŸ® VERTICAL BANNER<br>1080x1920</div>
                </div>
                <div class="banner-info">
                  <div class="banner-name">Story Banner</div>
                  <div class="banner-size">1080x1920 â€¢ Instagram/TikTok Stories</div>
                  <button class="banner-download-btn" onclick="downloadBanner('story')">â¬‡ï¸ Download</button>
                </div>
              </div>
              
              <div class="banner-item">
                <div class="banner-preview">
                  <img src="assets/banners/banner-youtube.png" alt="YouTube Banner" class="banner-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                  <div class="banner-placeholder" style="display: none;">ğŸ® YOUTUBE BANNER<br>1280x720</div>
                </div>
                <div class="banner-info">
                  <div class="banner-name">YouTube Thumbnail</div>
                  <div class="banner-size">1280x720 â€¢ YouTube/Video</div>
                  <button class="banner-download-btn" onclick="downloadBanner('youtube')">â¬‡ï¸ Download</button>
                </div>
              </div>
            </div>
            
            <div class="banner-tips">
              <h4>ğŸ’¡ Posting Tips</h4>
              <div class="tips-grid">
                <div class="tip-item">
                  <span class="tip-icon">ğŸ“±</span>
                  <span>Post during peak hours (7-9 PM)</span>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">ğŸ”—</span>
                  <span>Always include your promoter link</span>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">â°</span>
                  <span>Keep posts live for 24+ hours</span>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">ğŸ’°</span>
                  <span>Add engaging captions about earning SOL</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="social-share-section">
            <h3>ğŸ“± Quick Share</h3>
            <p>Click to post directly on your social media platforms:</p>
            <div class="social-buttons">
              <button class="social-btn twitter-btn" onclick="sharePromotersOnTwitter()">
                <span class="social-icon">ğŸ¦</span> Post on X
              </button>
              <button class="social-btn facebook-btn" onclick="sharePromotersOnFacebook()">
                <span class="social-icon">ğŸ“˜</span> Facebook
              </button>
              <button class="social-btn linkedin-btn" onclick="sharePromotersOnLinkedIn()">
                <span class="social-icon">ğŸ’¼</span> LinkedIn
              </button>
              <button class="social-btn instagram-btn" onclick="copyPromotersForInstagram()">
                <span class="social-icon">ğŸ“¸</span> Copy for Instagram
              </button>
              <button class="social-btn tiktok-btn" onclick="copyPromotersForTikTok()">
                <span class="social-icon">ğŸµ</span> Copy for TikTok
              </button>
            </div>
          </div>
          
          <div class="contact-section">
            <h3>ğŸ“ Submit Your Posts</h3>
            <div class="contact-buttons">
              <a href="https://t.me/goldmininggame" target="_blank" class="contact-btn telegram-btn">
                ğŸ“± Create Telegram Ticket
              </a>
              <a href="mailto:promoters@thegoldmining.com?subject=Promoter Application&body=Hi! I've posted your banner on social media. Here are my post links and details." target="_blank" class="contact-btn email-btn">
                ğŸ“§ Email Application
              </a>
            </div>
          </div>
        </div>
        
        <div id="promotersRequirement" class="promoters-requirement">
          <div class="requirement-box">
            <h3>ğŸ”’ Requirements to Become a Promoter</h3>
            <div class="requirement-steps">
              <div class="requirement-step">
                <span class="req-icon">ğŸ’³</span>
                <span class="req-text">Connect Your Wallet</span>
                <span class="req-status" id="walletStatusPromoters">âŒ Not Connected</span>
              </div>
              <div class="requirement-step">
                <span class="req-icon">ğŸ </span>
                <span class="req-text">Purchase Land (0.01 SOL)</span>
                <span class="req-status" id="landStatusPromoters">âŒ No Land</span>
              </div>
            </div>
            <p class="requirement-note">Complete these steps to unlock your promoter link and start earning 5-50 SOL daily!</p>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="promoters-cta-btn" onclick="closePromotersModal()">
          ğŸš€ Start Promoting & Earning SOL!
        </button>
      </div>
    </div>
  </div>

  <!-- V2.0 Coming Soon Modal -->
  <div id="v2ComingSoonModal" class="modal-overlay">
    <div class="modal-content v2-modal">
      <div class="modal-header v2-header">
        <h2>ğŸ„ Christmas Edition Features ğŸ…</h2>
        <button class="modal-close" onclick="closeV2Modal()">Ã—</button>
      </div>
      
      <div class="modal-body">
        <div class="v2-hero">
          <div class="v2-icon">ğŸ„âœ¨</div>
          <h3>Experience the Magic of Christmas Mining!</h3>
          <p>Ho ho ho! Enjoy our festive Christmas-themed mining adventure! ğŸ…</p>
        </div>

        <div class="v2-features">
          <div class="v2-feature-item success">
            <div class="feature-icon">ğŸ</div>
            <div class="feature-text">
              <strong>Christmas Gift System</strong>
              <p>Find magical Christmas gifts while mining! Open them for bonus gold and special rewards! ğŸ€</p>
            </div>
          </div>
          
          <div class="v2-feature-item info">
            <div class="feature-icon">â„ï¸</div>
            <div class="feature-text">
              <strong>Winter Wonderland Mines</strong>
              <p>Mine in beautiful snowy landscapes with festive decorations and holiday music! â›„</p>
            </div>
          </div>
          
          <div class="v2-feature-item success">
            <div class="feature-icon">ğŸ…</div>
            <div class="feature-text">
              <strong>Santa's Workshop Bonus</strong>
              <p>Help Santa's elves and earn special Christmas pickaxes with holiday magic! ğŸ§â€â™€ï¸âœ¨</p>
            </div>
          </div>
          
          <div class="v2-feature-item info">
            <div class="feature-icon">ğŸ„</div>
            <div class="feature-text">
              <strong>Holiday Special Events</strong>
              <p>Join Christmas mining events for exclusive rewards and festive surprises! ğŸŠğŸ†</p>
            </div>
          </div>
        </div>

        <div class="christmas-info-box">
          <h4>ğŸ„ About Christmas Edition</h4>
          <p>Experience the magic of Christmas in our gold mining adventure! This special edition includes festive decorations, holiday-themed items, and exclusive Christmas rewards. Mine gold while enjoying the Christmas spirit!</p>
        </div>

        <div class="v2-cta">
          <button class="v2-notify-btn" onclick="closeV2Modal()">
            ğŸ„ Start Christmas Mining!
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Referral Modal -->
  <div id="referralModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ Refer & Earn Free Pickaxes!</h2>
        <button class="modal-close" id="closeModal">&times;</button>
      </div>
      
      <div class="modal-body">
        <div class="referral-hero">
          <div class="referral-icon">ğŸš€</div>
          <p>Refer your friends and get <strong>FREE PICKAXES</strong>!</p>
          <p>The more referrals, the more pickaxes you earn!</p>
        </div>

        <div class="referral-rewards">
          <div class="reward-tier">
            <div class="tier-icon">ğŸ¥ˆ</div>
            <div class="tier-info">
              <div class="tier-count">1-10 Referrals</div>
              <div class="tier-reward">Free Silver Pickaxe + 100 Gold</div>
            </div>
          </div>
          
          <div class="reward-tier">
            <div class="tier-icon">ğŸ¥‡</div>
            <div class="tier-info">
              <div class="tier-count">11-17 Referrals</div>
              <div class="tier-reward">Free Gold Pickaxe + 100 Gold</div>
            </div>
          </div>
          
          <div class="reward-tier">
            <div class="tier-icon">ğŸ’</div>
            <div class="tier-info">
              <div class="tier-count">18-24 Referrals</div>
              <div class="tier-reward">Free Diamond Pickaxe + 100 Gold</div>
            </div>
          </div>
          
          <div class="reward-tier">
            <div class="tier-icon">ğŸŒŸ</div>
            <div class="tier-info">
              <div class="tier-count">25+ Referrals</div>
              <div class="tier-reward">Free Netherite Pickaxe + 100 Gold</div>
            </div>
          </div>
        </div>
        

        <!-- Referral Link Section - Show only after requirements met -->
        <div id="referralLinkSection" class="referral-link-section" style="display: none;">
          <label for="referralLink">ğŸ”— Your Referral Link:</label>
          <div class="link-container">
            <input type="text" id="referralLink" readonly placeholder="Your referral link will appear here..." />
            <button id="copyLinkBtn" class="copy-btn">ğŸ“‹ Copy</button>
          </div>
          <p class="link-info">âœ… Share this link to earn free pickaxes when friends join!</p>
          
          <div class="referral-stats" style="display: flex; justify-content: center; margin: 20px 0;">
            <div class="stat-box">
              <div class="stat-number" id="totalReferrals">0</div>
              <div class="stat-label">Total Referrals</div>
            </div>
          </div>

          <div class="social-share">
            <p>ğŸ“± Share on social media:</p>
            <div class="social-buttons">
              <button class="social-btn x" id="shareX">ğ• X</button>
              <button class="social-btn discord" id="shareDiscord">ğŸ’¬ Discord</button>
              <button class="social-btn telegram" id="shareTelegram">ğŸ“± Telegram</button>
            </div>
          </div>
        </div>
        
        <!-- Requirements Section - Show until both requirements met -->
        <div id="referralRequirement" class="promoters-requirement">
          <div class="requirement-box">
            <h3>ğŸ”’ Requirements to Access Referral System</h3>
            <div class="requirement-steps">
              <div class="requirement-step">
                <span class="req-icon">ğŸ’³</span>
                <span class="req-text">Connect Your Wallet</span>
                <span class="req-status" id="walletStatusReferral">âŒ Not Connected</span>
              </div>
              <div class="requirement-step">
                <span class="req-icon">ğŸ </span>
                <span class="req-text">Purchase Land (0.01 SOL)</span>
                <span class="req-status" id="landStatusReferral">âŒ No Land</span>
              </div>
            </div>
            <p class="requirement-note">Complete these steps to unlock your referral link and start earning free pickaxes!</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ğŸ¨ Random Background System -->
  <script src="random-background.js"></script>
  
  <script src="mining-engine-complete-optimized.js?v=1765367200"></script>
  <script src="main-fixed.js?v=1765367200"></script>
  
  <!-- ğŸ¯ FIXED SESSION TRACKING REFERRAL SYSTEM -->
  <script>
    // Enhanced referral tracking with proper session management
    (function() {
      const urlParams = new URLSearchParams(window.location.search);
      const ref = urlParams.get('ref');
      
      if (ref && ref.length > 20) { // Valid wallet address length
        console.log('ğŸ”— Referral detected, tracking visit...', ref.slice(0, 8) + '...');
        
        // Store referrer in localStorage as backup
        localStorage.setItem('referrer_address', ref);
        localStorage.setItem('referral_timestamp', Date.now().toString());
        
        // Load tracking pixel to log the visit
        const trackingPixel = new Image();
        trackingPixel.src = `/api/track-referral?ref=${encodeURIComponent(ref)}&t=${Date.now()}`;
        
        // Enhanced tracking with session persistence
        trackingPixel.onload = function() {
          console.log('âœ… Referral visit tracked successfully');
          localStorage.setItem('referral_tracked', 'true');
        };
        
        trackingPixel.onerror = function() {
          console.log('âš ï¸ Referral tracking failed, stored locally');
        };
        
        // Clean URL after tracking but preserve session data
        if (window.history && window.history.replaceState) {
          setTimeout(() => {
            window.history.replaceState({}, document.title, window.location.pathname);
          }, 2000); // Longer delay for tracking to complete
        }
        
        console.log('âœ… Enhanced referral tracking initiated');
      }
      
      // Check for existing referral data on page load
      const storedReferrer = localStorage.getItem('referrer_address');
      const trackingTime = localStorage.getItem('referral_timestamp');
      
      if (storedReferrer && trackingTime) {
        const hoursAgo = (Date.now() - parseInt(trackingTime)) / (1000 * 60 * 60);
        if (hoursAgo < 48) { // Within 48 hours
          console.log('ğŸ” Found stored referral data:', {
            referrer: storedReferrer.slice(0, 8) + '...',
            hoursAgo: hoursAgo.toFixed(1)
          });
          window.pendingReferral = {
            referrerAddress: storedReferrer,
            timestamp: trackingTime
          };
        } else {
          // Clean expired referral data
          localStorage.removeItem('referrer_address');
          localStorage.removeItem('referral_timestamp');
          localStorage.removeItem('referral_tracked');
        }
      }
    })();
  </script>
</body>
</html>